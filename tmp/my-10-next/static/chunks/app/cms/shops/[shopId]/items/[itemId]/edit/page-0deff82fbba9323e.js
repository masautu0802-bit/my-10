(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[187],{3428:(e,t,a)=>{"use strict";a.d(t,{default:()=>r});var s=a(5155),l=a(3321);function r({className:e="",iconSize:t=20,icon:a="arrow_back_ios_new",style:r,iconStyle:n}){let i=(0,l.useRouter)();return(0,s.jsx)("button",{onClick:()=>i.back(),className:e||"flex size-10 items-center justify-center rounded-full bg-white shadow-sm hover:scale-105 transition-transform text-text-main border border-sage/50",style:r,"aria-label":"戻る",children:(0,s.jsx)("span",{className:"material-symbols-outlined",style:{fontSize:t,...n},children:a})})}},7931:(e,t,a)=>{Promise.resolve().then(a.bind(a,8850))},8850:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>x});var s=a(5155),l=a(2115),r=a(3321),n=a(8884),i=a(9339);let o=(0,i.createServerReference)("6076be8268c11d3058402119a27dd6a9aed25c9ee4",i.callServer,void 0,i.findSourceMapURL,"updateItem");var c=a(6622),d=a(3428);function x({params:e}){let[t,a]=(0,l.useState)(""),[i,x]=(0,l.useState)(""),[m,u]=(0,l.useState)(""),[p,h]=(0,l.useState)(""),[b,f]=(0,l.useState)(""),[g,w]=(0,l.useState)(""),[j,v]=(0,l.useState)(""),[N,y]=(0,l.useState)(""),[k,_]=(0,l.useState)(!1),[S,C]=(0,l.useState)(!0),[R,U]=(0,l.useState)(""),[z,I]=(0,l.useTransition)(),L=(0,l.useRef)(null),E=(0,r.useRouter)();(0,l.useEffect)(()=>{e.then(async e=>{a(e.shopId),x(e.itemId);let t=(0,c.createBrowserClient)("https://xrlnbwrmascukxmwnqge.supabase.co","sb_publishable_aLlzFBj3cKzMd1WUl8ccKg_lw5naU8P"),{data:s}=await t.from("items").select("*").eq("id",e.itemId).single();s&&(u(s.name),h(s.price_range||""),f(s.ec_url||""),w(s.comment||""),v(s.image_url||""),y(s.image_url||"")),C(!1)})},[e]);let F=async e=>{let t=e.target.files?.[0];if(!t)return;let a=new FileReader;a.onload=e=>{y(e.target?.result)},a.readAsDataURL(t),_(!0),U("");try{let e=new FormData;e.append("file",t);let a=await (0,n.U)(e);a.error?(U(a.error),y(j||"")):a.url&&v(a.url)}catch{U("画像のアップロードに失敗しました"),y(j||"")}finally{_(!1)}};return S?(0,s.jsx)("div",{className:"bg-bgwarm min-h-screen flex items-center justify-center",children:(0,s.jsx)("p",{className:"text-text-main",children:"読み込み中..."})}):(0,s.jsxs)("div",{className:"bg-bgwarm min-h-screen flex flex-col antialiased max-w-md mx-auto shadow-2xl",children:[(0,s.jsxs)("header",{className:"flex items-center justify-between px-6 py-5 bg-bgwarm sticky top-0 z-20",children:[(0,s.jsx)(d.default,{}),(0,s.jsx)("h1",{className:"text-xl font-extrabold leading-tight tracking-tight text-text-main",children:"アイテム編集"}),(0,s.jsx)("button",{onClick:()=>E.back(),className:"text-text-muted font-bold text-sm px-2 hover:text-text-main transition-colors",children:"キャンセル"})]}),(0,s.jsxs)("main",{className:"flex-1 flex flex-col gap-6 px-6 pb-32 overflow-y-auto",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,s.jsx)("label",{className:"text-[11px] font-bold text-text-muted ml-2 uppercase tracking-wider",children:"商品画像"}),N?(0,s.jsxs)("div",{className:"relative bg-white border-2 border-sage/30 rounded-2xl p-4 shadow-sm",children:[(0,s.jsx)("div",{className:"aspect-square w-full max-w-xs mx-auto rounded-xl overflow-hidden bg-gray-100",children:(0,s.jsx)("img",{src:N,alt:"商品画像プレビュー",className:"w-full h-full object-cover"})}),k&&(0,s.jsx)("div",{className:"absolute inset-0 bg-white/70 rounded-2xl flex items-center justify-center",children:(0,s.jsxs)("div",{className:"flex items-center gap-2 text-text-main",children:[(0,s.jsx)("span",{className:"material-symbols-outlined animate-spin text-[20px]",children:"progress_activity"}),(0,s.jsx)("span",{className:"font-semibold text-sm",children:"アップロード中..."})]})}),!k&&(0,s.jsx)("button",{type:"button",onClick:()=>{v(""),y(""),L.current&&(L.current.value="")},className:"absolute top-2 right-2 flex size-8 items-center justify-center rounded-full bg-white shadow-md text-text-muted hover:text-coral transition-colors",children:(0,s.jsx)("span",{className:"material-symbols-outlined text-[18px]",children:"close"})})]}):(0,s.jsxs)("button",{type:"button",onClick:()=>L.current?.click(),className:"w-full bg-white border-2 border-dashed border-sage rounded-2xl px-5 py-10 flex flex-col items-center gap-3 hover:border-text-main/50 transition-all text-text-muted",children:[(0,s.jsx)("span",{className:"material-symbols-outlined text-[36px]",children:"add_photo_alternate"}),(0,s.jsx)("span",{className:"text-sm font-semibold",children:"タップして画像を選択"})]}),(0,s.jsx)("input",{ref:L,type:"file",accept:"image/*",onChange:F,className:"hidden"})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,s.jsxs)("label",{className:"text-[11px] font-bold text-text-muted ml-2 uppercase tracking-wider",children:["商品名 ",(0,s.jsx)("span",{className:"text-coral",children:"*"})]}),(0,s.jsx)("input",{className:"w-full bg-white border-2 border-sage rounded-2xl px-5 py-4 text-base font-semibold focus:outline-none focus:border-text-main focus:ring-0 transition-all placeholder:text-slate-300 text-text-main shadow-sm hover:border-text-main/50",type:"text",value:m,onChange:e=>u(e.target.value),placeholder:"商品名を入力してください"})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,s.jsx)("label",{className:"text-[11px] font-bold text-text-muted ml-2 uppercase tracking-wider",children:"価格"}),(0,s.jsx)("input",{className:"w-full bg-white border-2 border-sage rounded-2xl px-5 py-4 text-base font-semibold focus:outline-none focus:border-text-main focus:ring-0 transition-all placeholder:text-slate-300 text-text-main shadow-sm hover:border-text-main/50",type:"text",value:p,onChange:e=>h(e.target.value),placeholder:"例: \xa53,000"})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,s.jsx)("label",{className:"text-[11px] font-bold text-text-muted ml-2 uppercase tracking-wider",children:"購入リンク"}),(0,s.jsx)("input",{className:"w-full bg-white border-2 border-sage rounded-2xl px-5 py-4 text-base font-semibold focus:outline-none focus:border-text-main focus:ring-0 transition-all placeholder:text-slate-300 text-text-main shadow-sm hover:border-text-main/50",type:"url",value:b,onChange:e=>f(e.target.value),placeholder:"https://www.amazon.co.jp/..."}),(0,s.jsx)("p",{className:"text-xs text-text-muted ml-2",children:"Amazon等の購入ページURL（任意）"})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,s.jsx)("label",{className:"text-[11px] font-bold text-text-muted ml-2 uppercase tracking-wider",children:"コメント"}),(0,s.jsx)("textarea",{className:"w-full bg-white border-2 border-sage rounded-2xl px-5 py-4 text-base font-semibold focus:outline-none focus:border-text-main focus:ring-0 transition-all placeholder:text-slate-300 text-text-main shadow-sm hover:border-text-main/50 resize-none",rows:3,value:g,onChange:e=>w(e.target.value),placeholder:"この商品についてのコメント（任意）"})]}),R&&(0,s.jsx)("div",{className:"bg-coral/10 border border-coral/30 rounded-2xl p-4",children:(0,s.jsx)("p",{className:"text-coral text-sm font-medium text-center",children:R})}),(0,s.jsx)("div",{className:"mt-2 pb-4",children:(0,s.jsx)("button",{onClick:()=>{m.trim()?(U(""),I(async()=>{let e=await o(i,{name:m.trim(),ecUrl:b.trim()||void 0,imageUrl:j||void 0,priceRange:p.trim()||void 0,comment:g.trim()||void 0});e.error?U(e.error):E.push(`/cms/shops/${t}`)})):U("商品名を入力してください")},disabled:z||k||!m.trim(),className:"w-full bg-text-main hover:bg-text-main/90 text-white font-extrabold text-lg py-4 rounded-2xl shadow-lg shadow-text-main/20 transition-all active:scale-[0.98] active:shadow-none flex items-center justify-center gap-2 disabled:opacity-60",children:z?(0,s.jsx)("span",{className:"material-symbols-outlined animate-spin text-[20px]",children:"progress_activity"}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"material-symbols-outlined text-[20px]",children:"save"}),(0,s.jsx)("span",{children:"変更を保存"})]})})})]})]})}},8884:(e,t,a)=>{"use strict";a.d(t,{U:()=>l});var s=a(9339);let l=(0,s.createServerReference)("40b939e718d85017da81384118de7740aeba93d643",s.callServer,void 0,s.findSourceMapURL,"uploadItemImage")}},e=>{e.O(0,[756,441,794,358],()=>e(e.s=7931)),_N_E=e.O()}]);